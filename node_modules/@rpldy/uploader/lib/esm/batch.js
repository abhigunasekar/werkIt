import { BATCH_STATES, createBatchItem } from "@rpldy/shared";
import { DEFAULT_FILTER } from "./defaults";
import { getIsFileList } from "./utils";
var bCounter = 0;

var processFiles = function (batchId, files, isPending, fileFilter) {
  return Array.prototype.filter.call(files, fileFilter || DEFAULT_FILTER).map(function (f) {
    return createBatchItem(f, batchId, isPending);
  });
};

export default (function (files, uploaderId, options) {
  bCounter += 1;
  var id = "batch-".concat(bCounter);
  var isFileList = getIsFileList(files);
  files = Array.isArray(files) || isFileList ? files : [files];
  var isPending = !options.autoUpload;
  var items = processFiles(id, files, isPending, options.fileFilter);
  return {
    id: id,
    uploaderId: uploaderId,
    items: items,
    state: isPending ? BATCH_STATES.PENDING : BATCH_STATES.ADDED,
    completed: 0,
    loaded: 0,
    orgItemCount: items.length
  };
});